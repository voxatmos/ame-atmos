// ==UserScript==
// @namespace   ame-musicbrainz-works
// @name        Ame (MusicBrainz - Works)
// @version     0.4.2
// @author      SuperSaltyGamer
// @run-at      document-end
// @match       https://musicbrainz.org/*
// @match       https://beta.musicbrainz.org/*
// @match       https://www.minc.or.jp/*
// @match       https://iswcnet.cisac.org/*
// @match       https://www2.jasrac.or.jp/*
// @grant       GM.addStyle
// @grant       GM.xmlHttpRequest
// @grant       GM.setValue
// @grant       GM.getValue
// @grant       GM.deleteValue
// @downloadURL https://gitlab.com/SuperSaltyGamer/ame/-/raw/main/dist/musicbrainz-works.user.js
// @updateURL https://gitlab.com/SuperSaltyGamer/ame/-/raw/main/dist/musicbrainz-works.user.js
// ==/UserScript==

(function(l){typeof define=="function"&&define.amd?define(l):l()})(function(){"use strict";function l(e){return new Promise(t=>{setTimeout(t,e)})}function H(e){const t=document.createElement("template");return t.innerHTML=e,t.content.firstElementChild}function k(e,t){return new Promise(o=>{{const i=document.querySelector(e);if(i){o(i);return}}const r=setTimeout(()=>{a.disconnect(),o(null)},3e3),a=new MutationObserver(i=>{for(const c of i)for(const s of Array.from(c.addedNodes))if(s instanceof Element&&s.matches(e)){a.disconnect(),clearTimeout(r),o(s);return}});a.observe(document.body,{childList:!0,subtree:!0})})}function _(e,t){new MutationObserver(async n=>{for(const r of n)for(const a of r.addedNodes){if(!(a instanceof HTMLElement))continue;const i=a.matches(e)?a:a.querySelector(e);i&&await t(i)}}).observe(document.body,{childList:!0,subtree:!0})}function h(e,t){return document.evaluate(t,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}function y(e,t){const o=document.evaluate(t,e,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);return Array.from({length:o.snapshotLength},(n,r)=>o.snapshotItem(r))}const w=new AudioContext,V=new Set(`[á Šá³“â€¾ï¹‰-ï¹Œ_ï¼¿ï¹-ï¹ï¸³ï¸´â€—-ï¼ï¹£ÖŠá€á­ á †á ‡â€-â€“ï¸²â€”ï¹˜ï¸±â€•â¸ºâ¸»â“â¹ƒâ¸—â¹€â¹ã€œã‚ ãƒ»ï½¥ğº­,ï¼Œï¹ï¸â¸´â¸²â¹â¹Œâ¹â¹ÕØŒØÙ«Ù¬ß¸á ‚á ˆê“¾ê˜ê›µğ–º—ã€ï¹‘ï¸‘ï½¤ï¹…ï¹†ğ–¿¢;Í¾ï¼›ï¹”ï¸”Ø›ââ¸µê›¶â¹‰:ï¼šï¹•ï¸“â©´Ö‰ØÜƒ-Üˆà °-à ¾á¡á£-á¦á „á …à¼”áŸ–á­ê§‡á›«-á›­ê›´!ï¼ï¹—ï¸•Â¡â¹“Õœß¹á¥„ğ¥?ï¼Ÿï¹–ï¸–âˆâ‡Â¿â¸®â¹”ÕØŸÜ‰á§á¥…â³ºâ³»ê˜ê›·ê«±ğ‘…ƒğ¥Ÿâ€½â¸˜.ï¼â€¤ï¹’â€¥ï¸°â€¦ï¸™á Û”ÜÜ‚á¢á ƒá ‰á™®á­œâ³¹â³¾â¸°â¸¼ê“¿ê˜ê›³ğ–«µğ–º˜ğ›²Ÿã€‚ï¸’ï½¡Â·Î‡â¸±â¸³à¥¤à¥¥ê£ê£á°»á°¼ê¡¶ê¡·áœµáœ¶ê¤¯áŠá‹áŸ”áŸ•áª¨-áª«á­á­Ÿê§ˆê§‰ê©-ê©Ÿê«°ê¯«ğ©–ğ©—ğ‘‡ğ‘ˆğ‘ƒ€ğ‘ƒğ‘…ğ‘…‚ğ‘‡…ğ‘‡†ğ‘ˆ¸ğ‘ˆ¹ğ‘‘‹ğ‘‘Œğ‘—‚ğ‘—ƒğ‘™ğ‘™‚ğ‘œ¼ğ‘œ½ğ‘¥„ğ‘±ğ‘±‚ğ‘½ƒğ‘½„ğ–©®ğ–©¯á±¾á±¿ØÜ€ß·áƒ»á á¨á¨á¨Ÿá­šá­›á­½á­¾ê§-ê§†ê§Š-ê§ê›²ê¥Ÿğ¡—ğ¬º-ğ¬¿ğ½•-ğ½™ğ¾†-ğ¾‰ğ‘‚¾ğ‘‚¿ğ‘…€ğ‘‡ˆğ‘‡ğ‘‡Ÿğ‘Š©ğ‘œ¾ğ‘¥†ğ‘»·ğ‘»¸ğ‘½…-ğ‘½â•â–â˜-ââ¸ª-â¸­â¸½â³¼â³¿â¸™ğ¤¿ğ„€-ğ„‚ğŸğğ¤Ÿğ’‘°-ğ’‘´ğ’¿±ğ’¿²'ï¼‡â€˜-â€›×³â€¹â€º"ï¼‚â€œ-â€Ÿâ¹‚ã€-ã€Ÿ×´Â«Â»(ï¼ˆï¹™â½â‚ï¸µ)ï¼‰ï¹šâ¾â‚ï¸¶[ï¼»ï¹‡]ï¼½ï¹ˆ{ï½›ï¹›ï¸·}ï½ï¹œï¸¸à¼º-à¼½áš›ášœâ…â†âŒˆ-âŒ‹â§¼â§½â¦ƒ-â¦…ï½Ÿâ¦†ï½ â¦‡-â¦˜âŸ…âŸ†âŸ¦-âŸ¯â¨-âµâ¸‚-â¸…â¸‰â¸Šâ¸Œâ¸â¸œâ¸â¸ -â¸©â¹•-â¹œâŒ©ã€ˆï¸¿âŒªã€‰ï¹€ã€Šï¸½ã€‹ï¸¾ã€Œï¹ï½¢ã€ï¹‚ï½£ã€ï¹ƒã€ï¹„ã€ï¸»ã€‘ï¸¼ã€”ï¹ï¸¹ã€•ï¹ï¸ºã€–ï¸—ã€—ï¸˜ã€˜-ã€›ï´¾ï´¿â€–â¸¾â§˜-â§›Â§â¸¹Â¶â‹â¹â¸¿@ï¼ ï¹«*ï¼Šï¹¡ââ‘Ù­ê™³/ï¼\\ï¼¼ï¹¨â¹Š&ï¼†ï¹ âŠâ¹’#ï¼ƒï¹Ÿ%ï¼…ï¹ªÙªâ€°Ø‰â€±ØŠâ€ â€¡â¸¶-â¸¸â¹‹â€¢â€£â€§âƒâŒââ€²-â€´â—â€µ-â€·ã€ƒâ€¸â€»â€¿â”â€âââ‚â¸€â¸â¸†-â¸ˆâ¸‹â¸-â¸–â¸šâ¸›â¸â¸Ÿâ¹„-â¹ˆê™¾ÕšÕ›ÕŸÖ¾×€×ƒ×†ÜŠ-Üà¡á €ğ‘™ -ğ‘™¬à¥°ê£¸-ê£ºê£¼ğ‘¬€-ğ‘¬‰à§½à©¶à«°à±·à²„à·´à¹à¹šà¹›ê«ê«Ÿà¼„-à¼Šà¿à¿‘à¼‹-à¼’à¾…à¿’-à¿”à¿™à¿šğ‘¨¿-ğ‘©†ğ‘ªš-ğ‘ªœğ‘ª-ğ‘ª¢ğ‘±°ğ‘±±á°½-á°¿áŒ-ááŸ˜-áŸšáª -áª¦áª¬áª­á³€-á³‡âµ°ê¡´ê¡µá¯¼-á¯¿ê¤®ê§ê§Ÿê©œğ•¯ğ‘‰-ğ‘ğ©-ğ©•ğ©˜ğ‘±ƒ-ğ‘±…ğ¬¹ğ©¿ğ«°-ğ«¶ğ®™-ğ®œğ‘‚»ğ‘‚¼ğ‘…´ğ‘…µğ‘‡ğ‘‡‡ğ‘‡›ğ‘‡ğ‘ˆº-ğ‘ˆ½ğ‘‘ğ‘‘šğ‘‘ğ‘‘ğ‘‘›ğ‘‘ğ‘“†ğ‘—ğ‘—„-ğ‘——ğ‘™ƒğ‘š¹ğ‘ »ğ‘¥…ğ‘§¢ğ‘¿¿ğ–¬·-ğ–¬»ğ–­„ğ–º™ğ–ºšğª‡-ğª‹Øˆğ»°ğ»±â„˜â…-â…„â†ï¿©â†šâ†’ï¿«â†›â†‘ï¿ªâ†“ï¿¬â† â†£â†¦â‡’â‡â‡”â‡â‡´-âˆ‚ğ››ğœ•ğğ‰ğŸƒâˆƒ-âˆ‡ğ›ğ›»ğœµğ¯ğ©âˆˆ-âˆÏ¶âˆ-âˆ‘â…€+ï¼‹ï¬©ï¹¢âºâ‚ŠÂ±Ã·Ã—<ï¼œï¹¤â‰®=ï¼ï¹¦â¼â‚Œâ‰ â©µâ©¶>ï¼ï¹¥â‰¯Â¬ï¿¢|ï½œ~ï½âˆ’â»â‚‹â’âˆ“-âˆ•â„âˆ–-âˆ›Ø†âˆœØ‡âˆ-âˆ­â¨Œâˆ®-âˆ¼â‰âˆ½-â‰€â‰‚-â‰…â‰‡â‰†â‰ˆ-â‰â‰­â‰-â‰Ÿâ‰¡-â‰¤â‰°â‰¥â‰±â‰¦-â‰¬â‰²â‰´â‰³â‰µâ‰¶â‰¸â‰·â‰¹â‰ºâŠ€â‰»âŠâ‰¼â‹ â‰½â‹¡â‰¾â‰¿âŠ‚âŠ„âŠƒâŠ…âŠ†âŠˆâŠ‡âŠ‰-âŠ‘â‹¢âŠ’â‹£âŠ“-âŠ¢âŠ¬âŠ£-âŠ¨âŠ­âŠ©âŠ®âŠªâŠ«âŠ¯-âŠ²â‹ªâŠ³â‹«âŠ´â‹¬âŠµâ‹­âŠ¶-âŠ¼â…‹âŠ½-â‹Ÿâ‹¤-â‹©â‹®-â‹¿âŒ âŒ¡â¼â›-â³âœ-â¡â–·â—â—¸-â—ºâ—¿âŸ€-âŸ„âŸ‡-âŸ¥âŸ°-âŸ¿â¤€-â¤³â¤¶-â¦‚â¦™-â§—â§œ-â§»â§¾-â¨‹â¨-â©³â©·-â«›â«â«œâ«-â«¿â¬°-â­„â­‡-â­Œâ™¯â†”â†®â¤´â¤µâ€¼â‰ã€°ã€½â—¼â—»â—¾â—½]`.split("")),M={0:1,"ï¼":1,1:2,"ï¼‘":2,2:3,"ï¼’":3,3:4,"ï¼“":4,4:5,"ï¼”":5,5:6,"ï¼•":6,6:7,"ï¼–":7,7:8,"ï¼—":8,8:9,"ï¼˜":9,9:10,"ï¼™":10,a:11,ï½:11,ï¼¡:11,Ã¤:11,b:12,ï½‚:12,ï¼¢:12,c:13,ï½ƒ:13,ï¼£:13,d:14,ï½„:14,ï¼¤:14,e:15,ï½…:15,ï¼¥:15,f:16,ï½†:16,ï¼¦:16,g:17,ï½‡:17,ï¼§:17,h:18,ï½ˆ:18,ï¼¨:18,i:19,ï½‰:19,ï¼©:19,j:20,ï½Š:20,ï¼ª:20,k:21,ï½‹:21,ï¼«:21,l:22,ï½Œ:22,ï¼¬:22,m:23,ï½:23,ï¼­:23,n:24,ï½:24,ï¼®:24,o:25,ï½:25,ï¼¯:25,Ã¶:25,Ãµ:25,p:26,ï½:26,ï¼°:26,q:27,ï½‘:27,ï¼±:27,r:28,ï½’:28,ï¼²:28,s:29,ï½“:29,ï¼³:29,$:29,t:30,ï½”:30,ï¼´:30,u:31,ï½•:31,ï¼µ:31,Ã¼:31,v:32,ï½–:32,ï¼¶:32,w:33,ï½—:33,ï¼·:33,x:34,ï½˜:34,ï¼¸:34,y:35,ï½™:35,ï¼¹:35,z:36,ï½š:36,ï¼º:36},j=Object.entries(M).reduce((e,[t,o])=>(o in e||(e[o]=[]),e[o].push(t),e),{});function I(e){const t=M[e];return t?j[t]??[e]:[e]}function P(e){return e=e.replace(/[\sãƒ»]+/g,"").split("").map(t=>V.has(t)?"":`[${I(t).join("")}]`).join("[\\s\\p{Pc}\\p{Pd}\\p{Pe}\\p{Pf}\\p{Pi}\\p{Po}\\p{Ps}\\p{Sm}]{0,4}"),new RegExp(`(?<!<span class="ame__mark--inner">)${e}`,"gui")}function A(e,t){e.innerHTML=e.innerHTML.replaceAll(t,o=>{const n=document.createElement("span");n.classList.add("ame__mark--inner"),n.innerText=o;const r=document.createElement("span");return r.classList.add("ame__mark"),r.appendChild(n),r.outerHTML})}function T(e){const t=e.value;return e.addEventListener("input",()=>{e.value!==t&&(e.style.backgroundColor="yellow")}),e}function g(e,t){if(e instanceof HTMLInputElement){Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").set.call(e,t),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("focusout",{bubbles:!0}));return}if(e instanceof HTMLSelectElement){Object.getOwnPropertyDescriptor(HTMLSelectElement.prototype,"value").set.call(e,t),e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("focusout",{bubbles:!0}));return}}function N(e,t){const o=w.createOscillator(),n=w.createGain();o.connect(n),n.connect(w.destination),n.gain.value=.25,o.frequency.value=t,o.start(w.currentTime),o.stop(w.currentTime+e/1e3)}var m=(e=>(e.Work="work",e))(m||{});function W(e,t,o=!0){if(document.visibilityState==="visible")return o&&N(50,1e3),t==null?GM.deleteValue(e):(console.info("setBusValue",e,t),GM.setValue(e,{value:t,timestamp:new Date().getTime()+60*1e3}))}async function L(e){if(document.visibilityState!=="visible")return null;const t=await GM.getValue(e);return!t||(await W(e,null,!1),t.timestamp<new Date().getTime())?null:(console.info("getBusValue",e,t),t.value)}async function b(e,t){const o=await L(e);if(o)try{await t(o)}catch(n){console.error(n)}finally{await W(e,o)}}async function D(){_("a[class^='LandingPage_languageButton__']",()=>{location.href="/search"})}async function $(){let e=!1;await b(m.Work,async t=>{if(!t.iswc)return;const o=document.querySelector("#iswc"),n=document.querySelector("button[type='submit']");if(g(o,t.iswc),await l(800),n==null||n.click(),await l(500),e=await Promise.any([k("div[class^='Search_resultsContainer__'] div[class^='AlertMessage_text__']").then(()=>!0),k("[class^='Search_sectionTitle__']").then(i=>!i)]),e)return;const r=document.querySelector("[id='View More']");r.click(),await l(100);const a=h(document,"//button[.='Copy work codes']");a?(a.click(),t.codes.external=!0):r.after(H('<div style="padding: .5rem;">Install <a href="https://musicbrainz.org/doc/Guides/Userscripts#Userscripts:_Works">Bulk copy-paste work codes</a> for better integration.</div>')),t.sources.push(location.href),t.sources=Array.from(new Set(t.sources))}),e&&(location.href="/")}async function z(){return b(m.Work,async e=>{if(!(e!=null&&e.name))return;const t=document.querySelector("input[name='IN_WORKS_TITLE_NAME1']"),o=document.querySelector("button[name='CMD_SEARCH']");t.value!==e.name&&(g(t,e.name),o.click())})}async function F(){return b(m.Work,async e=>{var s,u,f,p;document.querySelector("a[href='#tab-00-07']").click(),await l(300);const o=((u=(s=h(document,"//*[contains(@class, 'baseinfo--iswc')]//strong"))==null?void 0:s.innerText)==null?void 0:u.trim())||null,n=((p=(f=h(document,"//*[contains(@class, 'baseinfo--code')]//strong"))==null?void 0:f.innerText)==null?void 0:p.trim())||null,r=y(document,"//table[contains(@class, 'detail')]//td[contains(., 'ä½œè©')]/parent::tr/*[2]").map(E).filter(Boolean).filter(d=>d!=="è­˜åˆ¥"),a=y(document,"//table[contains(@class, 'detail')]//td[contains(., 'ä½œæ›²')]/parent::tr/*[2]").map(E).filter(Boolean).filter(d=>d!=="è­˜åˆ¥"),i=y(document,"//table[contains(@class, 'detail')]//td[contains(., 'ç·¨æ›²')]/parent::tr/*[2]").map(E).filter(Boolean).filter(d=>d!=="è­˜åˆ¥"),c=y(document,"//table[contains(@class, 'detail')]//td[contains(., 'å‡ºç‰ˆè€…')]/parent::tr/*[2]").map(E).filter(Boolean).filter(d=>d!=="è­˜åˆ¥");o&&(e.iswc=o),n&&(e.codes.jasrac=n),e.lyricists=Array.from(new Set(r)),e.composers=Array.from(new Set(a)),e.arrangers=Array.from(new Set(i)),e.publishers=Array.from(new Set(c)),e.sources.push(location.href),e.sources=Array.from(new Set(e.sources))})}function E(e){var t,o;return((o=(t=e.textContent)==null?void 0:t.split(`
`)[0])==null?void 0:o.trim())??""}function G(){const e=document.querySelector(".logo > a");e&&(e.href=`${location.origin}/search`)}function U(){return b(m.Work,async e=>{if(!e.name)return;const t=document.querySelector("#kyokunm"),o=document.querySelector("#search-by-track-and-artist");t.value=e.name,o.click()})}function J(){for(const e of document.querySelectorAll(".saku-detail-link")){const t=document.createElement("a");t.target="_blank",t.href=`/saku/detail/?${e.getAttribute("data-href")}`,t.innerHTML=e.innerHTML,e.replaceWith(t)}return b(m.Work,async e=>{for(const n of e.context.tokens){const r=P(n);for(const a of document.querySelectorAll("#track-list tr td:nth-child(3), #track-list tr td:nth-child(4)"))A(a,r)}if(e.name)for(const n of document.querySelectorAll("#track-list tr td:nth-child(2)"))A(n,P(e.name));const t=document.querySelector("#kyokunm"),o=document.querySelector("#search-by-track-and-artist");!e.name||t.value===e.name||(t.value=e.name,o.click())})}function K(){return b(m.Work,async e=>{var s,u,f,p,d,B;const t=((u=(s=h(document,"//h3/text()[.!='-']"))==null?void 0:s.nodeValue)==null?void 0:u.replaceAll(" ",""))||null,o=((p=(f=h(document,"//a[@href='#jasrac']/following-sibling::*/span[2][.!='']"))==null?void 0:f.innerText)==null?void 0:p.trim())||null,n=((B=(d=h(document,"//a[@href='#nextone']/following-sibling::*/span[2][.!='']"))==null?void 0:d.innerText)==null?void 0:B.trim())||null,r=y(document,"//div[contains(@class, 'management')]//td[contains(., 'ä½œè©')]/parent::tr/*[2]").map(S).filter(Boolean),a=y(document,"//div[contains(@class, 'management')]//td[contains(., 'ä½œæ›²')]/parent::tr/*[2]").map(S).filter(Boolean),i=y(document,"//div[contains(@class, 'management')]//td[contains(., 'ç·¨æ›²')]/parent::tr/*[2]").map(S).filter(Boolean),c=y(document,"//div[contains(@class, 'management')]//td[contains(., 'å‡ºç‰ˆè€…')]/parent::tr/*[2]").map(S).filter(Boolean);t&&(e.iswc=t),o&&(e.codes.jasrac=o),n&&(e.codes.nextone=n),e.lyricists=Array.from(new Set(r)),e.composers=Array.from(new Set(a)),e.arrangers=Array.from(new Set(i)),e.publishers=Array.from(new Set(c)),e.sources.push(location.href),e.sources=Array.from(new Set(e.sources))})}function S(e){var t,o,n,r;return((r=(n=(o=(t=e.firstChild)==null?void 0:t.textContent)==null?void 0:o.split(`
`)[0])==null?void 0:n.replace(/\s*\/\s*$/,""))==null?void 0:r.trim())??""}let C=!1;function Q(){O(),_("#add-relationship-dialog",async e=>{const t=h(e,"//td[.='Work']/following-sibling::td//button");await l(100),t==null||t.click()})}async function X(){O();const e=T(document.querySelector("#id-edit-work\\.name")),t=T(document.querySelector("input[name='edit-work.iswcs.0']")),o=document.querySelector("#id-edit-work\\.edit_note"),n=await L(m.Work);if(!(n!=null&&n.sources.length)){C||await W(m.Work,{name:e.value||null,iswc:t.value||null,codes:{external:!1,jasrac:null,nextone:null},lyricists:[],composers:[],arrangers:[],publishers:[],sources:[],context:{tokens:Array.from(R(parent===window?document.body:parent.document.body))}});return}if(C=!0,n.iswc&&g(t,n.iswc),n.codes.jasrac&&q("jasrac",n.codes.jasrac),n.codes.nextone&&q("nextone",n.codes.nextone),n.sources.length&&(o.value=`Filled out with Ame (MusicBrainz - Works):
${n.sources.join(`
`)}
`),n.codes.external){const r=document.querySelector("#ROpdebee_MB_Paste_Work");r==null||r.click()}for(const r of n.lyricists)await v("artist","lyrics / lyricist",r);for(const r of n.composers)await v("artist","composed / composer",r);for(const r of n.arrangers)await v("artist","arranged / arranger",r);for(const r of n.publishers)await v("label","published / publisher",r.replace("æ ªå¼ä¼šç¤¾","").trim())}function O(){_("ul[id^='relationship-target']",async e=>{new MutationObserver(async o=>{const n=o[0],r=e.style.visibility;if(r==="hidden"||r===n.oldValue)return;const a=e.firstElementChild;if(a!=null&&a.innerText.includes("Click here to try again")){await l(100),a.click();return}const c=document.getElementById(e.getAttribute("aria-labelledby")).control,s=R();c.value&&s.add(c.value);for(const u of s){const f=P(u);for(const p of e.children)A(p,f)}}).observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:["style"]})})}function R(e=document.body){return new Set(Array.from(e.querySelectorAll("a[href^='/artist/'][title]")).map(t=>t.innerText.trim()))}async function v(e,t,o){document.querySelector("button.add-relationship").click();const r=await k("#add-relationship-dialog");if(!r)return;const a=r.querySelector("select.entity-type");g(a,e);const i=r.querySelector("input.relationship-type");g(i,t),h(r,`//li[contains(@class, 'option-item') and contains(., '${t}')]`).click();const c=r.querySelector(".relationship-target input");g(c,o),await l(300),r.querySelector(".relationship-target button").click(),await new Promise(u=>{const f=r.querySelector("button.negative"),p=r.querySelector("button.positive");f.addEventListener("click",()=>u()),p.addEventListener("click",()=>u())}),await l(300)}function q(e,t){e=e.toLowerCase();const o=document.querySelector("#add-work-attribute");for(let n=0;n<2;n++){for(const r of document.querySelectorAll("#work-attributes tr:not(:last-child)")){const a=r.querySelector("select"),i=a.selectedOptions[0],c=Array.from(a.options).filter(u=>u.innerText.trim().toLowerCase().startsWith(e))[0];if(i!==c&&i.value)continue;c.selected=!0;const s=T(r.querySelector("input"));s.value=t;return}o.click(),q(e,t)}}GM.addStyle(".ame__mark{background-color:#ff0e!important;outline:2px solid #ffff00ee!important}.ame__mark--inner{color:#000!important;filter:brightness(.1)}");const x=new URLSearchParams(location.search);window.addEventListener("focus",async()=>{var e,t;await l(100),!(!window.document.hasFocus()&&!((e=window.top)!=null&&e.document.hasFocus()))&&(location.host.endsWith("musicbrainz.org")?location.pathname.startsWith("/release/")&&location.pathname.endsWith("/edit-relationships")?await Q():(location.pathname.startsWith("/work/")&&location.pathname.endsWith("/edit")||location.pathname.startsWith("/dialog")&&((t=x.get("path"))!=null&&t.startsWith("/work/create")))&&await X():location.host.endsWith("minc.or.jp")?(await G(),location.pathname.startsWith("/search")?await U():location.pathname.startsWith("/music/list")?await J():location.pathname.startsWith("/saku/detail")&&await K()):location.host.endsWith("cisac.org")?(await D(),location.pathname.startsWith("/search")&&await $()):location.host.endsWith("jasrac.or.jp")&&(x.get("trxID")==="F00100"?await z():x.get("trxID")==="F20101"&&await F()))}),window.dispatchEvent(new Event("focus"))});
